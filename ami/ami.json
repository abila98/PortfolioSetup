{
  "variables": {
    "region": "us-west-1",
    "instance_type": "t2.micro",
    "ami_id": "ami-0ce2cb35386fc22e9",
    "owner_acc_id": "099720109477",
    "tag_version": "user `tag_version`",
    "ansible_vault_password": ""
   },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "{{user `region`}}",
      "instance_type": "{{user `instance_type`}}",
      "ami_name": "coffee-{{user `tag_version`}}",
      "source_ami_filter": {
        "filters": {
          "root-device-type": "ebs",
          "virtualization-type": "hvm"
        },
        "most_recent": true,
        "owners": ["{{user `owner_acc_id`}}"]
      },
      "ssh_username": "ubuntu",
      "ssh_agent_auth": "false",
      "ami_regions": ["{{user `region`}}"]
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sudo yum update -y"
      ]
    },
    {
      "type": "ansible",
      "playbook_file": "ami/ansible/deploy.yml",
      "extra_arguments": [
        "--vault-password-file=ami/vault_password_file"
      ]

    } 
  ]   
}
